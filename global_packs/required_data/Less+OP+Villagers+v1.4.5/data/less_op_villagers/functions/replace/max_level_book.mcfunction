# max_level_book


# reduce level by 1 if enchantment is max level (and max level is greater than 1)

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:bane_of_arthropods",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:bane_of_arthropods",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:blast_protection",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:blast_protection",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:depth_strider",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:depth_strider",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:efficiency",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:efficiency",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:feather_falling",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:feather_falling",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:fire_aspect",lvl:2s}]}}.tag.StoredEnchantments[{id:"minecraft:fire_aspect",lvl:2s}].lvl set value 1s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:fire_protection",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:fire_protection",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:fortune",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:fortune",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:frost_walker",lvl:2s}]}}.tag.StoredEnchantments[{id:"minecraft:frost_walker",lvl:2s}].lvl set value 1s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:impaling",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:impaling",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:knockback",lvl:2s}]}}.tag.StoredEnchantments[{id:"minecraft:knockback",lvl:2s}].lvl set value 1s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:looting",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:looting",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:loyalty",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:loyalty",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:luck_of_the_sea",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:luck_of_the_sea",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:lure",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:lure",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:piercing",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:piercing",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:power",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:power",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:projectile_protection",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:projectile_protection",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:protection",lvl:4s}]}}.tag.StoredEnchantments[{id:"minecraft:protection",lvl:4s}].lvl set value 3s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:punch",lvl:2s}]}}.tag.StoredEnchantments[{id:"minecraft:punch",lvl:2s}].lvl set value 1s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:quick_charge",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:quick_charge",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:respiration",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:respiration",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:riptide",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:riptide",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:sharpness",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:sharpness",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:smite",lvl:5s}]}}.tag.StoredEnchantments[{id:"minecraft:smite",lvl:5s}].lvl set value 4s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:soul_speed",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:soul_speed",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:sweeping",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:sweeping",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:thorns",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:thorns",lvl:3s}].lvl set value 2s

data modify entity @s Offers{}.Recipes[].sell{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:unbreaking",lvl:3s}]}}.tag.StoredEnchantments[{id:"minecraft:unbreaking",lvl:3s}].lvl set value 2s


# increase cost if max level is 1 (then doubling if treasure enchantment)

loot spawn ~ ~ ~ loot less_op_villagers:cost/book_3_high
tag @e[type=item,nbt={Item:{tag:{LOVcost:1b}}},limit=1] add LOVcost
data remove entity @e[type=item,tag=LOVcost,limit=1] Item.tag.LOVcost

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:aqua_affinity",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:aqua_affinity",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:channeling",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:channeling",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:binding_curse",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..38 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:binding_curse",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 2.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:vanishing_curse",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..38 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:vanishing_curse",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 2.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:flame",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:flame",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:infinity",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:infinity",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:mending",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..38 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:mending",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 2.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:multishot",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:multishot",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

execute store result score emerald_cost less_op_villagers run data get entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:silk_touch",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count
execute if score emerald_cost less_op_villagers matches 1..19 store result entity @s Offers{}.Recipes[{sell:{id:"minecraft:enchanted_book",tag:{StoredEnchantments:[{id:"minecraft:silk_touch",lvl:1s}]}}}].buy{id:"minecraft:emerald"}.Count byte 1.0 run data get entity @e[type=item,tag=LOVcost,limit=1] Item.Count

kill @e[type=item,tag=LOVcost,limit=1]
